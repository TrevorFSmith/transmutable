{% extends "banana/base.html" %}
{% load imagetags %}
{% load banana %}
{% block sub-title %}{{ user.get_full_name }} | {% endblock %}

{% block style %}
#work-doc, #completed-list {
	min-height: 400px; 	
}
#completed-list {
	-moz-border-radius: 2em 0 2em 0;
	border-radius: 2em 0 2em 0;
	padding: 0;
}
#completed-list > li {
	border: solid 2px #EEE;
	-moz-border-radius: 2em 0 2em 0;
	border-radius: 2em 0 2em 0;
	padding: 1em 1em 0.5em 1em;
}

#right-column {
	width: 580px;
	margin-left: 400px;
}

#work-doc {
	width: 99%;
	border: solid 2px #EEE;
	-moz-border-radius: 2em 0 2em 0;
	border-radius: 2em 0 2em 0;
	padding: 1em 1em 0.5em 1em;
}
.editable-section { 
	position: relative;
}
.editable-section:hover { background-color: #EEE; }
#work-doc-controls { visibility: hidden; float: right; padding: 0px; }
.editable-section:hover #work-doc-controls, #notes-list:hover form { visibility: visible; }

#left-column {
	width: 380px;
	float: left;
}

#top-right-column {
	float: right;
	width: 380px;
	height: 170px;
}
#top-right-column h3 a { text-decoration: none; }
#top-right-column:hover h3 a { text-decoration: underline; }
#notes-list {
	border: solid 2px #EEE;
	-moz-border-radius: 2em 0 2em 0;
	border-radius: 2em 0 2em 0;
	padding: 1em 1em 0.5em 1em;
	height: 120px;
}
#notes-list li { display: inline; margin-right: 10px; }
#notes-list form { text-align: left; visibility: hidden; }
#user-info { min-height: 170px; width: 600px; }

#work-doc-form textarea {
	width: 580px;
	height: 40em;
}

#center-bottom-message { text-align: right; }
{% endblock %}

{% block sub-head %}
<script>
var oldWorkDoc = null;

$(document).ready(function() {
	$('#work-doc-editor').hide();
	
	$('button[name="work-doc-form-button"]').click(function(){
		$('#work-doc-editor').hide();
		$('#work-doc-render').html('Submitting...');
		$('#work-doc').show();
		submitWorkdoc($('#work-doc-form'), $('#work-doc-render'));
	});
	$('button[name="work-doc-reset-button"]').click(function(){
		$('#work-doc-editor').hide();
		$('#work-doc').show();
		$('#work-doc-form textarea').val(oldWorkDoc);
	});
	$('button[name="edit-work-doc-button"]').click(function(){
		oldWorkDoc = $('#work-doc-form textarea').val();
		$('#work-doc').hide();
		$('#work-doc-editor').show();
	})

	$('button[name="completed-form-button"]').click(function(){ $('#completed-form').submit(); });
	$('#completed-form').submit(function(){
		submitCompletedItem($('#completed-form'), $('#completed-list'));
		$('#completed-form textarea').val('');
		return false;
	});
});
</script>
{% endblock %}

{% block content %}

<div id="top-right-column">
	<h2><a href="{% url peach.views.index %}">Notes</a>:</h2>
	<div id="notes-list" class="{% if request.user.username == user.username %}editable-section{% endif %}">
		{% if request.user == user and not user.namespaces.all %}
			<h3>This is your notes section.</h3>
			<p>Notes are multi-page documents for work info and thoughts.</p>
			<p>To create a note, hover your mouse over this section, enter a document name in the field that appears, and press "Enter".</p>
		{% endif %}
		<ul>
			{% for namespace in user.namespaces.all %}
			<li><a href="{{ namespace.get_absolute_url }}">{{ namespace.display_name }}</a></li>
			{% endfor %}
		</ul>
		{% if request.user.is_authenticated and request.user.username == user.username %}
			<form action="{% url peach.views.index %}" method="post" id="create-namespace-form">{% for field in namespace_form %}{{ field }}{% endfor %}</form>
		{% endif %}
	</div>
</div>

<div id="user-info">
	{% if user.get_profile.photo %}
	<img class="person-photo" src="{{ user.get_profile.photo.image.url|thumbnail:"150w" }}" width="150" title="{{ user.get_full_name}}" alt="{{ user.get_full_name}}" />
	{% else %}
	<img class="person-photo" src="{{ MEDIA_URL }}person/BlankIcon150x150.jpg" width="150" height="150" />		
	{% endif %}
	<h1>{{ user.get_full_name }}</h1>
</div>

<div id="left-column">
	{% if request.user == user %}{% include "banana/completed_form.frag" %}{% endif %}
	<h2>What I did:</h2>
	<ul id="completed-list">
	{% for completed_item in user.completed_items.all|slice:":10" %}
		{% completed_item_widget %}
	{% endfor %}
	</ul>
</div>

<div id="right-column">
	<h2>What I'm doing:</h2>
	{% if request.user == user %}
		<div id="work-doc-editor">
			<form id="work-doc-form" action="." method="post">
				{% for field in workdoc_form %}{{ field }}{% endfor %}
			</form>
			<button accesskey="s" name="work-doc-form-button" type="button" class="positive">save</button>
			<button name="work-doc-reset-button" type="button" class="negative">cancel</button>
			<div id="center-bottom-message">It's all <a target="top" href="http://daringfireball.net/projects/markdown/syntax">markdown</a>, don't cha know.</div>
		</div>
	{% endif %}
	<div id="work-doc" class="rendered-wrapper{% if request.user.username == user.username %} editable-section{% endif %}">
		{% if request.user.username == user.username %}<div id="work-doc-controls"><button name="edit-work-doc-button" class="positive">edit</button></div>{% endif %}
		<div id="work-doc-render">
			{% if request.user.username == user.username and not user.work_doc.rendered %}
				<h3>This is your workdoc.</h3>
				<p>Most people use this space to record to-do's and work notes.</p>
				<p>To make changes, hover your mouse over the workdoc and click "edit".</p>
			{% else %}
				{{ user.work_doc.rendered|safe }}
			{% endif %}
		</div>
	</div>
</div>
{% endblock %}